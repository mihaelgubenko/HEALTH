from django.core.management.base import BaseCommand
from core.models import Service


class Command(BaseCommand):
    help = 'Удаляет дублирующиеся услуги из базы данных'

    def handle(self, *args, **options):
        self.stdout.write('Очистка дублирующихся услуг...')

        # Находим дублирующиеся услуги по названию
        duplicate_names = [
            'Массаж для грудных детей',  # Оставляем эту
            'Массаж грудным детям',      # Удаляем эту
            'Лечебный массаж для мужчин (классический шведский)',  # Оставляем эту
            'Лечебный массаж (мужчины) - классический шведский',   # Удаляем эту
            'Лечебный массаж для женщин (классический шведский)',  # Оставляем эту
            'Лечебный массаж (женщины) - классический шведский',   # Удаляем эту
            'Диагностика организма биорезонансным сканированием (базовая)',  # Оставляем эту
            'Диагностика биорезонансным сканированием (базовая)',   # Удаляем эту
            'Диагностика организма биорезонансным сканированием (расширенная)',  # Оставляем эту
            'Диагностика биорезонансным сканированием (расширенная)',   # Удаляем эту
            'Диагностика организма биорезонансным сканированием (VIP)',  # Оставляем эту
            'Диагностика биорезонансным сканированием (VIP)',   # Удаляем эту
            'Подбор и демонстрация комплекса упражнений',  # Оставляем эту
            'Подбор комплекса упражнений',   # Удаляем эту
        ]

        deleted_count = 0
        for service_name in duplicate_names:
            services = Service.objects.filter(name=service_name)
            if services.count() > 1:
                # Оставляем первую услугу, удаляем остальные
                services_to_delete = services[1:]
                for service in services_to_delete:
                    self.stdout.write(f'Удаляем дублирующуюся услугу: {service.name} (ID: {service.id})')
                    service.delete()
                    deleted_count += 1

        self.stdout.write(f'\nУдалено {deleted_count} дублирующихся услуг')
        self.stdout.write(
            self.style.SUCCESS('✅ Дублирующиеся услуги успешно удалены!')
        )
