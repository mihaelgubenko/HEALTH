{% extends 'base.html' %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ò–ò-—Å–µ–∫—Ä–µ—Ç–∞—Ä—è{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –ò–ò-—Å–µ–∫—Ä–µ—Ç–∞—Ä—è</h2>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h5 class="card-title">üí¨ –î–∏–∞–ª–æ–≥–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h5>
                    <h2>{{ daily_stats.total_dialogs }}</h2>
                    <small>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–µ—Å—Å–∏–π: {{ daily_stats.unique_sessions }}</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h5 class="card-title">üìÖ –ó–∞–ø–∏—Å–∏ —Å–æ–∑–¥–∞–Ω—ã</h5>
                    <h2>{{ daily_stats.appointments_created }}</h2>
                    <small>–ó–∞ {{ daily_stats.date }}</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h5 class="card-title">üìà –ö–æ–Ω–≤–µ—Ä—Å–∏—è</h5>
                    <h2>{{ daily_stats.conversion_rate }}%</h2>
                    <small>–¥–∏–∞–ª–æ–≥ ‚Üí –∑–∞–ø–∏—Å—å</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <h5 class="card-title">üéØ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å</h5>
                    <h2>{{ success_rate.success_rate }}%</h2>
                    <small>–∑–∞ 7 –¥–Ω–µ–π</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>üéØ –¢–æ–ø –Ω–∞–º–µ—Ä–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h5>
                </div>
                <div class="card-body">
                    {% for intent in daily_stats.top_intents %}
                    <div class="d-flex justify-content-between mb-2">
                        <span>{{ intent.intent|capfirst }}</span>
                        <span class="badge badge-primary">{{ intent.count }}</span>
                    </div>
                    {% empty %}
                    <p class="text-muted">–î–∞–Ω–Ω—ã–µ –∑–∞ —Å–µ–≥–æ–¥–Ω—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏ -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>üèÜ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏ (30 –¥–Ω–µ–π)</h5>
                </div>
                <div class="card-body">
                    {% for service in popular_services %}
                    <div class="d-flex justify-content-between mb-2">
                        <span>{{ service.service__name|truncatechars:30 }}</span>
                        <span class="badge badge-success">{{ service.count }}</span>
                    </div>
                    {% empty %}
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–ø–∏—Å—è—Ö</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã -->
    <div class="row mt-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>‚è∞ –ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã –æ–±—Ä–∞—â–µ–Ω–∏–π (7 –¥–Ω–µ–π)</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for hour in peak_hours %}
                        <div class="col-md-2 text-center mb-3">
                            <div class="badge badge-outline-primary p-3">
                                <h5>{{ hour.hour }}:00</h5>
                                <small>{{ hour.count }} –æ–±—Ä–∞—â–µ–Ω–∏–π</small>
                            </div>
                        </div>
                        {% empty %}
                        <p class="text-muted">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        {% if daily_stats.conversion_rate < 10 %}
                        <li>üìä –ö–æ–Ω–≤–µ—Ä—Å–∏—è –Ω–∏–∑–∫–∞—è - —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã</li>
                        {% endif %}
                        
                        {% if success_rate.success_rate < 70 %}
                        <li>üéØ –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤</li>
                        {% endif %}
                        
                        <li>üí° –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø–∏–∫–æ–≤—ã–µ —á–∞—Å—ã –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</li>
                        <li>üîÑ –û–±–Ω–æ–≤–ª—è–π—Ç–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <a href="{% url 'core:chat' %}" class="btn btn-primary">üí¨ –ü–µ—Ä–µ–π—Ç–∏ –∫ —á–∞—Ç—É</a>
            <a href="{% url 'admin:core_dialoglog_changelist' %}" class="btn btn-secondary">üìã –õ–æ–≥–∏ –¥–∏–∞–ª–æ–≥–æ–≤</a>
            <a href="{% url 'admin:core_appointment_changelist' %}" class="btn btn-success">üìÖ –ó–∞–ø–∏—Å–∏</a>
        </div>
    </div>
</div>

<style>
.badge-outline-primary {
    border: 2px solid #007bff;
    color: #007bff;
    background: transparent;
}
</style>
{% endblock %}
